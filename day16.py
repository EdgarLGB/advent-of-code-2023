input = r"""
.|...\....
|.-.\.....
.....|-...
........|.
..........
.........\
..../.\\..
.-.-/..|..
.|....-|.\
..//.|....
"""

input2 = r"""
\./....\../......................|............../-.......|....................|....../|\..../.............\...
...........|.-.............|.././........../........................./...........||.....................-....\
...............\.............-...................-............/.|...|.......-...............................-.
.......................................\..|-.../\....../.........|............/...|.....-.|...........\...|...
............/.-..|...\........|...........-......................\.........-........\....../....|.........|...
................-...........-|....\.................-........\........\...|.././......./......................
......................-....../.-........../........\....../..../.............-..........|.|.................|.
...|....................|.|../.......\.......|.......-...............|.......\......\....................|\...
.........\.............|.......-.....................|....................|..................-.......\-...\...
.../............-........../.||..../........-...../-.........-......./......\........|........................
....|..../.../../.....\..............-.-................../........|...../....\....\...................|......
.......\..-..................|..../..........|....................-............/...................\|../......
..-.\................../................../....\........./...\.\/.............................\|..............
.......-...............................-.......|....................|......................../...........|/...
................|...\-....-.......|/......./.......................|../.\-...-....../...\........\......\.|...
.....................-.......-....-................|.............-........-....................\....../....-..
\..|.|....-......../......../.../...................|.....................\..--...............-.......||......
.....-.\.....................-...\............../....\.......-/../|...|......../..\..................../......
....|...\......................|...|.../...|...............\...........-........................|.......--.-..
......\....|.-...........\................................|.................\..............\..|...............
...................||..................\|...................|....\............-....../........\.../.....-...-.
....................................|....|......./.\..................../..............|../.............\.....
......|...\./......../......|....\..././.......|...............................-.........../.-..\.............
.|.../....|.................-..............|..................\....../..........-..........|...|......|./.....
.........|.........../..\...|....../...................................................-......................
../....|/.............|.........../....................\.......\............./.........../.......-.........\-.
................\....................\.....-..|............-......-|...............\......\...-...............
..........|..........|...........|.../.............................-......\.....|\.........\.\.............../
.........................../...........\.............|................../.-.......-....././\.........-........
\....\................../..../.............-../......|.\.........-./..\........./.............................
.\..../..............|........../.......\........|.-.-........//\.......|.....-.../..-.....-...........-......
.......|................\.....................\.............-........./..................-...-...........\....
....../.......-......././.-.....|..........|.........|..........\............................/................
................\......\................\\.\..\........\.................................\......-/.....-......
..-...../......-.......................................|.................|......-.-...-.....\....../...-......
........................\....|.....\....|............................\..............\.......................\.
............................/|...|........\.\....\......-|......................|.....|.\-...-......-.........
\..|...........................\.................\.-................../................./..../.\..............
|.../.............\...............................|..|..-......-.......-.......|..\../.........-...........|..
...........|................\............................../.......................|..../-|...................
...\.|.\..................|.\-/....../-/..|/............\......../\.\...........\\.......-....-\..............
.................................-......./..-............|..\../..................................|/./|..../..
.../..../........|-.........|.....|..............-.................../.....|-.......|.....|...............\...
-..-...................//............................./.........-...............-.........|.../...........\...
.............././\......|..............\..................|...............-............................-......
/.........|/.....-../|......-.........|..-.-...........-........|..........-..................................
.............\.......|/........../.....|.......-....-....../......-...................-....|........\.........
\...|.|.../..|....../....-.........................-..............|.....\.......-........\........-....|......
-.-..\..........|........................./..........|..-./...........................|...........-........-..
....\./..............-.........|......./.-..............-.-../\........|..|.........-..............\...\.../..
..|...........\...../......../.../.........\....../....-..................................|/............-...|.
.../.........|..-................|..........|....\/..........|..|\.......|...........|........................
........../.............\...\.............................-...................|................-...-..........
.....................-.................................../../.............................-../................
.-........./......|........-...../...................\..|-........-...\..........././||.......................
.........|../../.....-...........-....-..-...|.............................\..................................
...................-.....\......../............./...............-.......\.........../........|............../.
.|\.............................................-.........-....|.....\..................-..-.......\..........
/................/....\.........\|...............-.............|......./...........-.....\........-.......--..
..........-........\........\-...\....\\........../...|./.........................\.....|.................\../
............................-.|............................\...\../..........................\......./...../..
.....//.......|..\.........-..\.........-....\..-..\.....-.....//.../.........................................
................................|....|..\............/|./.\....|.............-..\|................./..........
.....|.......-.............-../...../.........|../.....................|........................./.....|......
.-...\...../................\.-........|..|...|...|.........\|......|...../...../..........\................|.
.../../............-.........|................\.....\....-...................../.../...........-...|...../|...
..-..........-.......-.............\..............-..............\.......|....................................
..|................/........................-...................../.................................|......../
...../........\......./....../......||.......|-...............-.....-............../../.......................
...\..../...................-........\.........\............................/....|.........-..........-.......
.../................\....\..|-...........................\.-..-......|.|.-/.....-............./...............
../............\...........................-../....|....................-..............|........./......|...\\
.........................\..................|..\........................./....................\...............
/.............|.....................-.....\.....-..|............/..........|./...|....-...-....|-....../......
.\.-.....\............././.........................\..........-......................|........\...............
........\../............../......\.....\..-............|............\............../..|.......................
....-../....\..................................-......../...|................................................-
.......................\............-...................../.........\............-../.........\/..|../....-/|.
..../.............|....../............-.|......../.....................|...../..|.....-.............../.......
....................|\...........-...................................../.......................-...-..|..\.|/.
......................-....-\........../..............\.......-....\.....|...............\.........-..........
.|......../.....|.........||.................../.....\...|.........\........../........\............../.......
.-............/-..........-...........\..........\.......-....................................................
.....|/....-.../......-......................../.|./...\.......\/......./......../..\...../...|...|.........\-
.............../..\.../-......|\\......../............../............|/......................./.......\.......
.....\.-./....../............/..-................../....\..................-.................|.......-/..-....
.-................-..-...........................-..|............-.................../...........-...........|
-......\......|......\............../.............../...-/.../....\.........................-.....|.....-.....
.......\.....--.-............................\..........-./........||......|..\...../..../................|...
.............-.....|..../.......|............|....................-......\.............../|...............|...
............|........../........|....................-....|....../.........\..........-........-..-...........
..............|.................-....|...........\.|.../.........../..........-......\|.............\..-......
......-............\.......\....................................................|\..\.......................-.
................||...........\...-\/..|..............\.........................../.......\.|.............|...|
....-...................-...../....|............\.../.........-..../....\........../..../.|..........\........
........-.....\........../....|.........\......./...........\.......-..|............../...........-..|........
.................../.....-...........|....-...\......\...|...|...........................\.......||......\|...
......-.........|.....\....-..........|.......\....\..................................../........|...|./......
..................\.........../.............../.................../.........-.......-..../............/\.../..
........\...\...\....../.......\\........../............../.-.................../........|..............-.....
....../........................|................-.-......-....|......\\.-...-.|..........|..../...............
/.......-.....|.....\...................|...../..............|......|.../....................\.....|..........
|.\....-...............|/....|........../....................................\.-............................/.
.......................-...............-.|...................|......\.....-\..|.......-......./\.....-......-.
................................|../.................................-........-...................|...........
.....-.........\..-................./...........|...............|....................\/../../........|.-......
............................../......./.\/........./..|..............|.......................\................
......./.-.......\...........-...............|............|.............|..........|.|..........|.........--..
............-..............-.............\./...|.....|................|..........|/.............\.............
.../....................-........-.................../.....\.............-...................\................
"""


def decode(input):
    result = []
    for line in input.split("\n"):
        if not line:
            continue
        result.append(line)
    return result


from dataclasses import dataclass


@dataclass(frozen=True)
class State:
    i: int
    j: int
    direction: tuple


east = (0, 1)
south = (1, 0)
west = (0, -1)
north = (-1, 0)


def launch(initial_cursor, grid):
    traversed = set()
    cursors = [initial_cursor]
    while len(cursors) > 0:
        next_cursors = []
        for cursor in cursors:
            if cursor in traversed:
                continue
            traversed.add(cursor)
            cursor_output = move(cursor, grid)
            if cursor_output:
                next_cursors.extend(cursor_output)
        cursors = next_cursors

    return set(map(lambda x: (x.i, x.j), traversed))


def calculate_energized_tiles(input):
    grid = decode(input)

    result = launch(State(0, -1, east), grid)

    for i in range(len(grid)):
        line = ""
        for j in range(len(grid[0])):
            if (i, j) in result:
                line += "#"
            else:
                line += "."
        print(line)
    return len(result) - 1


def move(cursor, grid):
    next_i = cursor.i + cursor.direction[0]
    next_j = cursor.j + cursor.direction[1]
    if next_i >= 0 and next_i < len(grid) and next_j >= 0 and next_j < len(grid[0]):
        symbol = grid[next_i][next_j]
        if symbol == "|":
            if cursor.direction in [east, west]:
                return [State(next_i, next_j, north), State(next_i, next_j, south)]
            if cursor.direction in [south, north]:
                return [State(next_i, next_j, cursor.direction)]
        if symbol == "-":
            if cursor.direction in [east, west]:
                return [State(next_i, next_j, cursor.direction)]
            if cursor.direction in [south, north]:
                return [State(next_i, next_j, west), State(next_i, next_j, east)]
        if symbol == "/":
            if cursor.direction == east:
                return [State(next_i, next_j, north)]
            if cursor.direction == south:
                return [State(next_i, next_j, west)]
            if cursor.direction == west:
                return [State(next_i, next_j, south)]
            if cursor.direction == north:
                return [State(next_i, next_j, east)]
        if symbol == "\\":
            if cursor.direction == east:
                return [State(next_i, next_j, south)]
            if cursor.direction == south:
                return [State(next_i, next_j, east)]
            if cursor.direction == west:
                return [State(next_i, next_j, north)]
            if cursor.direction == north:
                return [State(next_i, next_j, west)]
        if symbol == ".":
            return [State(next_i, next_j, cursor.direction)]
    return []


print(calculate_energized_tiles(input2))

###### Part two ######


def calculate_largest_energized_tiles(input):
    grid = decode(input)
    result = 0
    for j in range(len(grid[0])):
        traversed = launch(State(-1, j, south), grid)
        result = max(result, len(traversed) - 1)
        traversed = launch(State(len(grid), j, south), grid)
        result = max(result, len(traversed) - 1)
    for i in range(len(grid)):
        traversed = launch(State(i, -1, east), grid)
        result = max(result, len(traversed) - 1)
        traversed = launch(State(i, len(grid[0]), west), grid)
        result = max(result, len(traversed) - 1)
    return result

print(calculate_largest_energized_tiles(input2))
